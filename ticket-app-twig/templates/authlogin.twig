{% extends "base.twig" %}

{% block title %}Login - TicketApp{% endblock %}

{% block content %}
<div class="card" style="max-width: 520px; margin: 12px auto;">
  <h2>Login</h2>
  <form id="loginForm" aria-label="Login form">
    <div class="form-row">
      <label for="username">Username</label>
      <input id="username" type="text" required />
    </div>
    <div class="form-row">
      <label for="password">Password</label>
      <input id="password" type="password" required />
    </div>
    <div id="loginError" class="form-error" role="alert" style="display: none;"></div>
    <div style="display: flex; gap: 12px; margin-top: 12px;">
      <button class="btn btn-primary" type="submit">Login</button>
      <a href="authsignup.php" class="btn btn-ghost">Sign up</a>
    </div>
  </form>
</div>

<script type="module">
  import { signIn, isAuthenticated } from '/public/js/auth.js';
  import { showToast } from '/public/js/toast.js';
  
  // Redirect if already authenticated
  if (isAuthenticated()) {
    window.location.href = 'dashboard.php';
  }
  
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const errorDiv = document.getElementById('loginError');
    errorDiv.style.display = 'none';
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
      errorDiv.textContent = 'Please fill all fields';
      errorDiv.style.display = 'block';
      return;
    }
    
    const res = signIn(username, password);
    if (!res.success) {
      errorDiv.textContent = res.message || 'Login failed';
      errorDiv.style.display = 'block';
      return;
    }
    
    showToast('Login successful! Redirecting...', 'success');
    setTimeout(() => {
      window.location.href = 'dashboard.php';
    }, 500);
  });
</script>
{% endblock %}


